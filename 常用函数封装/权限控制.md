## ä¸€ã€è·¯ç”±æƒé™æ§åˆ¶

```ts
// router/index.ts
router.beforeEach((to, from, next) => {
  const token = localStorage.getItem('token');
  const userRoles = getUserRoles(); // ['admin'] ç­‰

  if (to.meta?.roles && !to.meta.roles.includes(userRoles)) {
    return next('/403');
  }

  next();
});

// è·¯ç”±é…ç½®ç¤ºä¾‹
{
  path: '/admin',
  name: 'AdminPage',
  component: AdminPage,
  meta: { roles: ['admin'] }
}
```

### äºŒã€åŠ¨æ€èœå•ç”Ÿæˆï¼ˆåŸºäºæƒé™ï¼‰

```ts
const asyncRoutes = [
  { path: "/dashboard", name: "Dashboard", meta: { roles: ["admin", "user"] } },
  { path: "/admin", name: "AdminPanel", meta: { roles: ["admin"] } },
];

function generateMenus(routes, roles) {
  return routes.filter((route) => {
    return (
      !route.meta?.roles ||
      route.meta.roles.some((role) => roles.includes(role))
    );
  });
}
```

### ä¸‰ã€æŒ‰é’®æƒé™æ§åˆ¶ï¼ˆv-permission æŒ‡ä»¤ï¼‰

```ts
// v-permission æŒ‡ä»¤å°è£…
app.directive("permission", {
  mounted(el, binding) {
    const roles = getUserRoles(); // ['user']
    if (!roles.includes(binding.value)) {
      el.parentNode && el.parentNode.removeChild(el);
    }
  },
});
```

```html
<!-- ä»… admin å¯è§ -->
<button v-permission="'admin'">åˆ é™¤ç”¨æˆ·</button>
```

## âš›ï¸ React æƒé™æ§åˆ¶

### ä¸€ã€è·¯ç”±æƒé™å°è£…ï¼ˆé«˜é˜¶ç»„ä»¶ï¼‰

```tsx
const PrivateRoute = ({ children, roles, ...rest }) => {
  const userRoles = getUserRoles();

  const hasAccess = !roles || roles.some((role) => userRoles.includes(role));
  return hasAccess ? children : <Navigate to="/403" />;
};

<Route
  path="/admin"
  element={
    <PrivateRoute roles={["admin"]}>
      <AdminPage />
    </PrivateRoute>
  }
/>;
```

### äºŒã€åŠ¨æ€èœå•æ¸²æŸ“

```tsx
const menus = [
  { path: "/dashboard", name: "Dashboard", roles: ["admin", "user"] },
  { path: "/admin", name: "Admin Panel", roles: ["admin"] },
];

const Menu = () => {
  const roles = getUserRoles();
  return (
    <ul>
      {menus
        .filter(
          (item) =>
            !item.roles || item.roles.some((role) => roles.includes(role)),
        )
        .map((menu) => (
          <li key={menu.path}>{menu.name}</li>
        ))}
    </ul>
  );
};
```

### ä¸‰ã€æŒ‰é’®æƒé™å°è£…ç»„ä»¶

```tsx
const AuthButton = ({ roles, children }) => {
  const userRoles = getUserRoles();
  return roles.some((role) => userRoles.includes(role)) ? children : null;
};

// ä½¿ç”¨
<AuthButton roles={["admin"]}>
  <button>åˆ é™¤</button>
</AuthButton>;
```

### ğŸ“¦ æƒé™é…ç½®ç»“æ„è®¾è®¡å»ºè®®

```ts
// åç«¯è¿”å›çš„æƒé™æ•°æ®ç»“æ„

{
  token: 'xxxxx',
  userInfo: {
    name: 'å°æ˜', // â€¢	rolesï¼šç”¨äºè·¯ç”±ã€èœå•çº§åˆ«æ§åˆ¶
    roles: ['admin'], // â€¢	permissionsï¼šç”¨äºæŒ‰é’®ã€åŠŸèƒ½æ§åˆ¶
    permissions: ['user:add', 'user:delete']
  }
}
```
