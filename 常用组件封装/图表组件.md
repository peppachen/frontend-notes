## React + ECharts

### å°è£…æ¶æ„è®¾è®¡

ğŸ“ chart
â”œâ”€â”€ chartConfigMap.ts // å›¾è¡¨é…ç½®ä¸­å¿ƒ
â”œâ”€â”€ ChartRenderer.tsx // é€šç”¨å›¾è¡¨æ¸²æŸ“ç»„ä»¶
â””â”€â”€ index.tsx // ä½¿ç”¨ç¤ºä¾‹

â¸»

### é…ç½®ä¸­å¿ƒï¼ˆchartConfigMap.tsï¼‰

```ts
//  ç±»å‹å®šä¹‰
export interface BarLineData {
  labels: string[];
  values: number[];
}

export interface PieDataItem {
  name: string;
  value: number;
}

export type ChartType = "bar" | "line" | "pie";

export interface ChartProps {
  type: ChartType;
  data: any;
  theme?: "light" | "dark";
  height?: string;
  onChartClick?: (params: any) => void;
  onChartHover?: (params: any) => void;
  onChartOut?: (params: any) => void;
}

// chartConfigMap.ts
import { EChartsOption } from "echarts";

export const chartConfigMap: Record<string, (data: any) => EChartsOption> = {
  bar: (data: BarLineData) => ({
    xAxis: { type: "category", data: data.labels },
    yAxis: { type: "value" },
    series: [{ type: "bar", data: data.values }],
  }),

  line: (data: BarLineData) => ({
    xAxis: { type: "category", data: data.labels },
    yAxis: { type: "value" },
    series: [{ type: "line", data: data.values }],
  }),

  pie: (data: PieDataItem[]) => ({
    series: [
      {
        type: "pie",
        radius: "50%",
        data: data,
      },
    ],
  }),
};
```

### é€šç”¨å›¾è¡¨ç»„ä»¶å°è£…ï¼ˆChartRenderer.tsxï¼‰

```tsx
// ChartRenderer.tsx
import React, { useEffect, useRef } from "react";
import * as echarts from "echarts/core";
import { BarChart, LineChart, PieChart } from "echarts/charts";
import {
  TitleComponent,
  TooltipComponent,
  GridComponent,
  LegendComponent,
  DatasetComponent,
} from "echarts/components";
import { CanvasRenderer } from "echarts/renderers";
import { ChartProps } from "../types/chart";
import { chartConfigMap } from "./chartConfigMap";

echarts.use([
  TitleComponent,
  TooltipComponent,
  GridComponent,
  LegendComponent,
  DatasetComponent,
  BarChart,
  LineChart,
  PieChart,
  CanvasRenderer,
]);

const EChartWrapper: React.FC<ChartProps> = ({
  type,
  data,
  theme = "light",
  height = "400px",
  onChartClick,
  onChartHover,
  onChartOut,
}) => {
  const chartRef = useRef<HTMLDivElement>(null);
  const chartInstanceRef = useRef<echarts.ECharts | null>(null);

  const initChart = () => {
    if (!chartRef.current || !chartConfigMap[type]) return;

    if (chartInstanceRef.current) {
      chartInstanceRef.current.dispose();
    }

    const chart = echarts.init(chartRef.current, theme);
    const option = chartConfigMap[type](data);
    chart.setOption(option);

    if (onChartClick) chart.on("click", onChartClick);
    if (onChartHover) chart.on("mouseover", onChartHover);
    if (onChartOut) chart.on("mouseout", onChartOut);

    chartInstanceRef.current = chart;
  };

  useEffect(() => {
    initChart();
    const handleResize = () => {
      chartInstanceRef.current?.resize();
    };
    window.addEventListener("resize", handleResize);
    return () => {
      chartInstanceRef.current?.dispose();
      window.removeEventListener("resize", handleResize);
    };
  }, [type, data, theme]);

  const exportAsImage = () => {
    const url = chartInstanceRef.current?.getDataURL({ type: "png" });
    if (url) {
      const link = document.createElement("a");
      link.href = url;
      link.download = `${type}-chart.png`;
      link.click();
    }
  };

  return (
    <>
      <div ref={chartRef} style={{ width: "100%", height }} />
      <button onClick={exportAsImage} style={{ marginTop: "8px" }}>
        å¯¼å‡ºå›¾è¡¨ä¸º PNG
      </button>
    </>
  );
};

export default EChartWrapper;
```

### ä½¿ç”¨ç¤ºä¾‹ï¼ˆDashboard.tsxï¼‰

```tsx
// Dashboard.tsx
import React, { useState } from "react";
import EChartWrapper from "./components/EChartWrapper";

const Demo: React.FC = () => {
  const [type, setType] = useState<"bar" | "line" | "pie">("bar");
  const [theme, setTheme] = useState<"light" | "dark">("light");

  const barData = {
    labels: ["Mon", "Tue", "Wed", "Thu", "Fri"],
    values: [120, 200, 150, 80, 70],
  };

  const pieData = [
    { name: "A", value: 40 },
    { name: "B", value: 25 },
    { name: "C", value: 35 },
  ];

  return (
    <div>
      <EChartWrapper
        type={type}
        data={type === "pie" ? pieData : barData}
        theme={theme}
        onChartClick={(e) => console.log("Click:", e)}
        onChartHover={(e) => console.log("Hover:", e)}
      />

      <div style={{ marginTop: "1rem" }}>
        <button onClick={() => setType("bar")}>Bar</button>
        <button onClick={() => setType("line")}>Line</button>
        <button onClick={() => setType("pie")}>Pie</button>
        <button
          onClick={() => setTheme((t) => (t === "light" ? "dark" : "light"))}
        >
          åˆ‡æ¢ä¸»é¢˜
        </button>
      </div>
    </div>
  );
};

export default Demo;
```

### é¢è¯•åœºæ™¯è¡¨è¾¾

â€œæˆ‘ä»¬åœ¨æ•°æ®èµ„äº§å¹³å°ä¸­å°è£…äº†ä¸€å¥—é€šç”¨å›¾è¡¨ç»„ä»¶ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒæŠ½è±¡å‡ºå›¾è¡¨ç±»å‹ä¸ç”Ÿæˆé€»è¾‘ï¼Œç»„ä»¶åªéœ€ä¼ å…¥ type ä¸ dataï¼Œå³å¯å¿«é€Ÿç”ŸæˆæŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ç­‰ã€‚æ•´ä¸ªç»„ä»¶çš„å¤ç”¨ç‡è¶…è¿‡ 80%ï¼Œå¼€å‘æ•ˆç‡æå‡çº¦ 40%ã€‚åŒæ—¶é€šè¿‡ç»Ÿä¸€ç®¡ç†å›¾è¡¨é€»è¾‘ï¼Œé™ä½åæœŸç»´æŠ¤æˆæœ¬ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„å¯æ‰©å±•æ€§å’Œç¨³å®šæ€§ã€‚â€

## Vue3 + ECharts5

### ç›®å½•ç»“æ„

ğŸ“ components
â””â”€â”€ ğŸ“ Chart
â”œâ”€â”€ chartConfigMap.ts # é…ç½®ä¸­å¿ƒ
â”œâ”€â”€ EChartWrapper.vue # é€šç”¨ç»„ä»¶å°è£…
â””â”€â”€ index.ts # ç»Ÿä¸€å¯¼å‡º

### é…ç½®ä¸­å¿ƒï¼ˆchartConfigMap.tsï¼‰

```ts
// chartConfigMap.ts
// ç»´æŠ¤æ‰€æœ‰å›¾è¡¨ç±»å‹å¯¹åº”çš„optionç”Ÿæˆå‡½æ•°
export const chartConfigMap = {
  bar: (data: any[]) => ({
    xAxis: { type: "category", data: data.map((i) => i.name) },
    yAxis: { type: "value" },
    series: [{ type: "bar", data: data.map((i) => i.value) }],
  }),

  line: (data: any[]) => ({
    xAxis: { type: "category", data: data.map((i) => i.name) },
    yAxis: { type: "value" },
    series: [{ type: "line", data: data.map((i) => i.value) }],
  }),

  pie: (data: any[]) => ({
    series: [
      {
        type: "pie",
        radius: "50%",
        data,
        emphasis: {
          itemStyle: {
            shadowBlur: 10,
            shadowOffsetX: 0,
            shadowColor: "rgba(0, 0, 0, 0.5)",
          },
        },
      },
    ],
  }),

  radar: (data: { indicator: any[]; value: number[] }) => ({
    radar: { indicator: data.indicator },
    series: [{ type: "radar", data: [{ value: data.value }] }],
  }),
};
```

### å›¾è¡¨ç»„ä»¶å°è£…ï¼ˆEChartWrapper.vueï¼‰

```vue
<!-- EChartWrapper.vue -->
<template>
  <div ref="chartRef" :style="{ width: '100%', height: height }"></div>
</template>

<script setup lang="ts">
import * as echarts from "echarts";
import { onMounted, onBeforeUnmount, ref, watch } from "vue";
import { chartConfigMap } from "./chart/chartConfigMap";

const props = defineProps<{
  type: keyof typeof chartConfigMap;
  data: any;
  theme?: "light" | "dark";
  height?: string;
}>();

const emit = defineEmits<{
  (e: "chart-click", params: any): void;
  (e: "chart-mouseover", params: any): void;
  (e: "chart-mouseout", params: any): void;
}>();

const chartRef = ref<HTMLDivElement | null>(null);
let chartInstance: echarts.ECharts | null = null;

const renderChart = () => {
  if (!chartRef.value || !props.data || !props.type) return;
  chartInstance?.dispose();
  chartInstance = echarts.init(chartRef.value, props.theme || "light");
  const optionGenerator = chartConfigMap[props.type];
  const options = optionGenerator?.(props.data);
  if (options) chartInstance.setOption(options);

  // ç»‘å®šäº‹ä»¶
  chartInstance.on("click", (params) => emit("chart-click", params));
  chartInstance.on("mouseover", (params) => emit("chart-mouseover", params));
  chartInstance.on("mouseout", (params) => emit("chart-mouseout", params));
};

const handleResize = () => {
  chartInstance?.resize();
};

onMounted(() => {
  renderChart();
  window.addEventListener("resize", handleResize);
});

onBeforeUnmount(() => {
  chartInstance?.dispose();
  window.removeEventListener("resize", handleResize);
});

watch(() => [props.data, props.type, props.theme], renderChart, { deep: true });

// æš´éœ²å¯¼å‡ºæ–¹æ³•ç»™çˆ¶ç»„ä»¶
defineExpose({
  exportAsImage() {
    if (!chartInstance) return;
    const base64 = chartInstance.getDataURL({ type: "png" });
    const a = document.createElement("a");
    a.href = base64;
    a.download = `${props.type}-chart.png`;
    a.click();
  },
});
</script>

<style scoped>
div {
  width: 100%;
  height: 100%;
}
</style>
```

### çˆ¶ç»„ä»¶ä½¿ç”¨ç¤ºä¾‹ï¼ˆDashboard.vueï¼‰

```vue
<!-- Dashboard.vue -->
<template>
  <div style="width: 100%; height: 400px;">
    <EChartWrapper
      ref="chartRef"
      :type="chartType"
      :data="chartData"
      :theme="chartTheme"
      @chart-click="onClick"
    />
    <button @click="exportChart">å¯¼å‡ºå›¾è¡¨</button>
    <button @click="toggleTheme">åˆ‡æ¢ä¸»é¢˜</button>
  </div>
</template>

<script setup lang="ts">
import { ref } from 'vue';
import EChartWrapper from './components/EChartWrapper.vue';

const chartRef = ref();
const chartType = ref('bar');
const chartData = ref({...});
const chartTheme = ref<'light' | 'dark'>('light');

const exportChart = () => {
  chartRef.value?.exportAsImage();
};

const toggleTheme = () => {
  chartTheme.value = chartTheme.value === 'light' ? 'dark' : 'light';
};

const onClick = (params: any) => {
  console.log('ç‚¹å‡»äº‹ä»¶å‚æ•°', params);
};
</script>
```

### é¢è¯•åœºæ™¯æ¨èè¡¨è¾¾

> â€œåœ¨ Vue3 é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å°è£…äº†ä¸€ä¸ªé€šç”¨çš„å›¾è¡¨ç»„ä»¶ï¼Œé€šè¿‡é…ç½®ä¸­å¿ƒæŠ½è±¡å‡ºä¸åŒå›¾è¡¨çš„ option ç”Ÿæˆé€»è¾‘ã€‚ä¸šåŠ¡ç»„ä»¶åªéœ€è¦ä¼ å…¥ type å’Œ dataï¼Œå³å¯å¿«é€Ÿæ¸²æŸ“æŸ±çŠ¶å›¾ã€æŠ˜çº¿å›¾ã€é¥¼å›¾ç­‰å›¾è¡¨ã€‚ç»„ä»¶æ”¯æŒå“åº”å¼æ›´æ–°ã€æŒ‰éœ€åŠ è½½ ECharts æ¨¡å—ï¼Œæœ‰æ•ˆæå‡å›¾è¡¨å¼€å‘æ•ˆç‡çº¦ 40%ï¼Œå¹¶å°†å›¾è¡¨æ¨¡å—å¤ç”¨ç‡æå‡åˆ° 80% ä»¥ä¸Šã€‚â€
